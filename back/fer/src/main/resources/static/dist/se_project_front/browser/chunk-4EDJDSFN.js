import{a as B}from"./chunk-QKDHF5WC.js";import{b as I,d as W,e as T,f as F,g as z,h as A,l as L,m as j,n as D,q as H}from"./chunk-TKRMQVQD.js";import{$ as E,A as h,D as d,G as i,H as n,K as M,L as O,M as a,N as b,O as S,P as N,Q as g,R as p,S as u,_ as w,a as m,aa as U,ca as _,e as v,fa as k,i as y,l as x,t as s,v as f,w as P}from"./chunk-YG25EE7E.js";var C=class l{constructor(t){this.http=t}apiUrl="https://restcountries.com/v3.1/all?fields=name";getCountries(){return this.http.get(this.apiUrl).pipe(v(t=>t.map(o=>o.name.common).sort((o,e)=>o.localeCompare(e))))}static \u0275fac=function(o){return new(o||l)(x(_))};static \u0275prov=y({token:l,factory:l.\u0275fac,providedIn:"root"})};function q(l,t){if(l&1&&(i(0,"div",18),a(1),n()),l&2){let o=O();s(),b(o.errorMessage)}}function J(l,t){if(l&1&&(i(0,"option",19),a(1),n()),l&2){let o=t.$implicit;d("value",o),s(),b(o)}}function K(l,t){if(l&1&&(i(0,"option",19),a(1),n()),l&2){let o=t.$implicit;d("value",o),s(),b(o)}}var R=class l{constructor(t,o,e,c){this.countryService=t;this.router=o;this.authService=e;this.http=c}is_editing=!1;user={firstName:"",lastName:"",email:"",country:"Croatia",notifications:"No"};notificationsOptions=["Yes","No"];editableUser=m({},this.user);countries=[];errorMessage="";loadUserData(t){console.log(t),console.log(localStorage);let o=localStorage.getItem("firstName"),e=localStorage.getItem("lastName"),c=localStorage.getItem("email");console.log("test2"),o&&c&&e?(this.user.firstName=o,this.user.lastName=e,this.user.email=c,this.editableUser=m({},this.user)):(this.user.firstName=t.attributes.given_name,this.user.lastName=t.attributes.family_name,this.user.email=t.attributes.email,localStorage.setItem("firstName",t.firstName),localStorage.setItem("lastName",t.lastName),this.editableUser=m({},this.user)),console.log(this.user)}ngOnInit(){setTimeout(()=>{this.checkAuthAndLoad()},1500),this.countryService.getCountries().subscribe(t=>{this.countries=t})}toggleEdit(){this.is_editing=!this.is_editing,this.editableUser=m({},this.user)}saveChanges(){if(!this.editableUser.firstName||!this.editableUser.lastName||!this.editableUser.email||!this.editableUser.country||!this.editableUser.notifications){this.errorMessage="Fields can't be empty.";return}this.errorMessage="",this.is_editing=!1,this.user=m({},this.editableUser),console.log("User updated : ",this.user),this.authService.updateUser(this.user.email,this.user.firstName,this.user.lastName).subscribe()}resetPassword(){this.router.navigate(["/profile/reset_password"])}goToDelete(){this.router.navigate(["/profile/delete_account"])}logout(){localStorage.removeItem("token"),localStorage.removeItem("email"),localStorage.removeItem("firstName"),localStorage.removeItem("lastName"),this.router.navigate(["/auth/login"])}checkAuthAndLoad(){this.http.get("http://localhost:8080/user/me",{withCredentials:!0}).subscribe({next:t=>{console.log("\u2705 Utilisateur authentifi\xE9:",t),this.loadUserData(t)},error:t=>{console.log("\u274C Non authentifi\xE9, redirection vers Google..."),window.location.href="http://localhost:8080/oauth2/authorization/google"}})}static \u0275fac=function(o){return new(o||l)(f(C),f(k),f(B),f(_))};static \u0275cmp=P({type:l,selectors:[["app-edit-profile"]],decls:49,vars:17,consts:[[1,"edit-profile-page"],[1,"profile-header"],[3,"click"],[1,"profile-container"],[1,"form-section"],["class","error-message",4,"ngIf"],[1,"form-grid"],[1,"form-group"],["type","text","name","firstName",3,"ngModelChange","ngModel","disabled"],["type","text","name","lastName",3,"ngModelChange","ngModel","disabled"],["type","email","name","email",3,"ngModelChange","ngModel","disabled"],["name","country",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["name","notifications",3,"ngModelChange","ngModel","disabled"],[1,"secondary"],[1,"buttons"],[1,"progress"],[1,"delete"],[1,"error-message"],[3,"value"]],template:function(o,e){o&1&&(i(0,"div",0)(1,"div",1)(2,"h2"),a(3),n(),i(4,"p"),a(5),n(),i(6,"button",2),M("click",function(){return e.is_editing?e.saveChanges():e.toggleEdit()}),a(7),n(),i(8,"button",2),M("click",function(){return e.logout()}),a(9,"Log Out"),n()(),i(10,"div",3)(11,"div",4),h(12,q,2,1,"div",5),i(13,"h3"),a(14,"Account Information"),n(),i(15,"form")(16,"div",6)(17,"div",7)(18,"label"),a(19,"First Name"),n(),i(20,"input",8),u("ngModelChange",function(r){return p(e.editableUser.firstName,r)||(e.editableUser.firstName=r),r}),n()(),i(21,"div",7)(22,"label"),a(23,"Last Name"),n(),i(24,"input",9),u("ngModelChange",function(r){return p(e.editableUser.lastName,r)||(e.editableUser.lastName=r),r}),n()(),i(25,"div",7)(26,"label"),a(27,"Email"),n(),i(28,"input",10),u("ngModelChange",function(r){return p(e.editableUser.email,r)||(e.editableUser.email=r),r}),n()(),i(29,"div",7)(30,"label"),a(31,"Country"),n(),i(32,"select",11),u("ngModelChange",function(r){return p(e.editableUser.country,r)||(e.editableUser.country=r),r}),h(33,J,2,2,"option",12),n()(),i(34,"div",7)(35,"label"),a(36,"Notifications"),n(),i(37,"select",13),u("ngModelChange",function(r){return p(e.editableUser.notifications,r)||(e.editableUser.notifications=r),r}),h(38,K,2,2,"option",12),n()(),i(39,"div",7)(40,"label"),a(41,"Password"),n(),i(42,"button",14),a(43,"Reset Password"),n()()()()(),i(44,"div",15)(45,"button",16),a(46,"View My Progress"),n(),i(47,"button",17),a(48,"Delete My Account"),n()()()()),o&2&&(s(3),N("",e.user.firstName," ",e.user.lastName,""),s(2),b(e.user.email),s(2),S(" ",e.is_editing?"Save Changes":"Edit Profile"," "),s(5),d("ngIf",e.errorMessage),s(8),g("ngModel",e.editableUser.firstName),d("disabled",!e.is_editing),s(4),g("ngModel",e.editableUser.lastName),d("disabled",!e.is_editing),s(4),g("ngModel",e.editableUser.email),d("disabled",!e.is_editing),s(4),g("ngModel",e.editableUser.country),d("disabled",!e.is_editing),s(),d("ngForOf",e.countries),s(4),g("ngModel",e.editableUser.notifications),d("disabled",!e.is_editing),s(),d("ngForOf",e.notificationsOptions))},dependencies:[U,w,E,H,A,j,D,I,L,W,T,z,F],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{margin:0;padding:0;width:100%;overflow-x:hidden}.edit-profile-page[_ngcontent-%COMP%]{min-height:100vh;width:100%;background:linear-gradient(180deg,#a8c5e2,#d7c7e9);margin:0;padding:0;box-sizing:border-box;font-family:Lato,sans-serif}.profile-header[_ngcontent-%COMP%]{text-align:center;padding-top:50px}h2[_ngcontent-%COMP%]{font-size:28px;margin-bottom:10px;margin-top:0}.profile-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;background-color:#3eac87;border:1px solid black;border-radius:20px;cursor:pointer;transition:background-color .2s,transform .2s ease;margin:10px;color:#fff}.profile-header[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#309674;transform:scale(1.05)}.profile-container[_ngcontent-%COMP%]{max-width:720px;margin:30px auto 0;padding:45px;background-color:#f3faff;border-radius:10px;border:1px solid black;text-align:center;width:100%;height:100%;box-sizing:border-box}.form-section[_ngcontent-%COMP%]{text-align:left}h3[_ngcontent-%COMP%]{margin-bottom:25px;font-size:20px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);row-gap:35px;column-gap:100px;align-items:end}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}label[_ngcontent-%COMP%]{font-weight:700;margin-bottom:6px}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%], .secondary[_ngcontent-%COMP%]{box-sizing:border-box;width:100%;padding:8px 10px;border-radius:5px;border:1px solid black;background-color:#fff;font-size:15px;transition:border-color .2s,box-shadow .2s}select[_ngcontent-%COMP%], .secondary[_ngcontent-%COMP%]{padding-right:12px}input[_ngcontent-%COMP%]:disabled, select[_ngcontent-%COMP%]:disabled{background-color:#e9e9e9;cursor:not-allowed}input[_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus{outline:none;border-color:#000;box-shadow:0 0 5px #45a04966}.buttons[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:20px;margin-top:40px}button[_ngcontent-%COMP%]{padding:10px 20px;font-size:16px;background-color:#85f1ff;border:1px solid black;border-radius:5px;cursor:pointer;transition:background-color .2s,transform .2s ease;margin:10px}button[_ngcontent-%COMP%]:hover{background-color:#62d5e5;transform:scale(1.05)}.progress[_ngcontent-%COMP%]{border-radius:20px;background-color:#ccc;cursor:not-allowed;width:50%}.progress[_ngcontent-%COMP%]:hover{background-color:#ccc}.delete[_ngcontent-%COMP%]{border-radius:20px;background-color:#ff8b94;width:50%}.delete[_ngcontent-%COMP%]:hover{background-color:#f75764}.secondary[_ngcontent-%COMP%]{background-color:#ffd580;margin:0;padding:8px 10px;transition:background-color .2s,transform .2s ease}.secondary[_ngcontent-%COMP%]:hover{background-color:#e6ac47;transform:scale(1.05)}.error-message[_ngcontent-%COMP%]{color:red;font-weight:700;margin-bottom:15px;text-align:center}@media (max-width: 768px){.profile-container[_ngcontent-%COMP%]{width:90%;padding:30px}.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;row-gap:25px;column-gap:0}.form-group[_ngcontent-%COMP%]{width:100%}.buttons[_ngcontent-%COMP%]{flex-direction:column;gap:15px}.progress[_ngcontent-%COMP%]{width:100%}h2[_ngcontent-%COMP%]{font-size:22px}h3[_ngcontent-%COMP%]{font-size:18px}}"]})};export{R as EditProfileComponent};
