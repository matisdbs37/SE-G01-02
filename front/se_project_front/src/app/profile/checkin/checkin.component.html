<div class="container">

  <!-- Progress bar showing completion of the mood check-in -->
  <div class="progress-bar">
    <div class="progress" [style.width.%]="getProgress()"></div>
  </div>

  <!-- Initial welcome screen before starting the check-in -->
  <div *ngIf="currentQuestionIndex == -1" class="question-box">
    <h2>Welcome to your Mood Check-in !</h2>
    <br>
    <h2>Let's start !</h2>
    <!-- Button to start the questionnaire -->
    <button (click)="startQuestionnaire()">Start</button>
  </div>

  <!-- Mood check-in questions -->
  <div *ngIf="currentQuestionIndex >= 0 && currentQuestionIndex < this.questions.length" class="question-box">
    <!-- Display current question text -->
    <h2>{{ questions[currentQuestionIndex].text }}</h2>

    <!-- Text input question -->
    <input
      *ngIf="questions[currentQuestionIndex].type == 'text'"
      type="text"
      [placeholder]="questions[currentQuestionIndex].placeholder"
      [(ngModel)]="answers[currentQuestionIndex]"
    >

    <!-- Yes/No question -->
    <div *ngIf="questions[currentQuestionIndex].type == 'yes_no'" class="yes-no-group">
      <button 
        class="yes_button" 
        [class.selected]="answers[currentQuestionIndex] === 'Yes'"
        (click)="answers[currentQuestionIndex] = 'Yes'">
        Yes
      </button>
      <button 
        class="no_button" 
        [class.selected]="answers[currentQuestionIndex] === 'No'"
        (click)="answers[currentQuestionIndex] = 'No'">
        No
      </button>
    </div>

    <!-- Slider question -->
    <div *ngIf="questions[currentQuestionIndex].type == 'slider'" class="slider-group">
      <input type="range"
            [min]="questions[currentQuestionIndex].min"
            [max]="questions[currentQuestionIndex].max"
            [(ngModel)]="answers[currentQuestionIndex]">

      <!-- Show current slider value -->
      <div class="slider-value">
        {{ answers[currentQuestionIndex] }}
      </div>
    </div>

    <!-- Select (dropdown) question -->
    <div *ngIf="questions[currentQuestionIndex].type == 'select'">
      <select [(ngModel)]="answers[currentQuestionIndex]">
        <!-- Placeholder option to prompt selection -->
        <option value="" disabled> {{questions[currentQuestionIndex].placeholder}} </option>
        <!-- Loop through available options -->
        <option *ngFor="let opt of questions[currentQuestionIndex].options" [value]="opt">
          {{ opt }}
        </option>
      </select>
    </div>

    <!-- Error message displayed if the user tries to continue without answering -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Navigation buttons -->
    <div class="button-group">
      <!-- Back button hidden for the first question -->
      <button *ngIf="currentQuestionIndex != 0" (click)="previousQuestion()">Back</button>
      <!-- Next button to move forward -->
      <button (click)="nextQuestion()">Next</button>
    </div>
  </div>

  <!-- Final screen after completing all questions -->
  <div *ngIf="currentQuestionIndex == (this.questions.length)" class="question-box">
        <h2>Thanks for your answers !</h2>
        <br>
        <h2>You can now go back to your profile !</h2>
        <div class="button-group">
          <!-- Back button to review last question -->
          <button *ngIf="currentQuestionIndex != 0" (click)="previousQuestion()">Back</button>
          <!-- Save answers and finish check-in -->
          <button (click)="save()">Save and continue</button>
        </div>
  </div>

</div>