<!-- LOADING SCREEN -->
<div *ngIf="loading; else sessionContent" class="loading-screen">
  <div class="loader"></div>
  <p>Accessing the catalog…</p>
</div>

<!-- MAIN CONTENT -->
<ng-template #sessionContent>
  <div class="videos-background">
    <div class="videos-page">

      <!-- BACK BUTTON -->
      <button class="back" (click)="back()">← Back to home</button>

      <h2>Meditation Library</h2>

      <!-- FILTERS BAR -->
      <div class="filters-bar">
        <!-- Search by title -->
        <input type="text" 
               placeholder="Search by title..." 
               [(ngModel)]="searchText" 
               (ngModelChange)="onFilterChange()">

        <!-- Category filter -->
        <select [(ngModel)]="selectedCategory" (ngModelChange)="onFilterChange()">
          <option value="">All Categories</option>
          <option *ngFor="let c of categories" [value]="c.id">{{ c.name }}</option>
        </select>

        <!-- Type filter (video/audio) -->
        <select [(ngModel)]="selectedType" (ngModelChange)="onFilterChange()">
          <option value="">All Types</option>
          <option *ngFor="let t of types" [value]="t">{{ t | titlecase }}</option>
        </select>

        <!-- Rating filter -->
        <select [(ngModel)]="selectedRating" (ngModelChange)="onFilterChange()">
          <option value="">Any Rating</option>
          <option value="5">5⭐</option>
          <option value="4">4⭐ or more</option>
          <option value="3">3⭐ or more</option>
          <option value="2">2⭐ or more</option>
          <option value="1">1⭐ or more</option>
          <option value="none">Not rated</option>
        </select>

        <!-- Language filter -->
        <select [(ngModel)]="selectedLanguage" (ngModelChange)="onFilterChange()">
          <option value="">All Languages</option>
          <option *ngFor="let l of languages" [value]="l">{{ l }}</option>
        </select>

        <!-- Difficulty filter -->
        <select [(ngModel)]="selectedDifficulty" (ngModelChange)="onFilterChange()">
          <option [ngValue]="null">Any Difficulty</option>
          <option [ngValue]="1">Beginner (1)</option>
          <option [ngValue]="2">Intermediate (2)</option>
          <option [ngValue]="3">Advanced (3)</option>
        </select>

        <!-- Duration filter -->
        <select [(ngModel)]="selectedDuration" (ngModelChange)="onFilterChange()">
          <option value="">Any Duration</option>
          <option value="short">&lt; 20 min</option>
          <option value="medium">20–40 min</option>
          <option value="long">&gt; 40 min</option>
        </select>
      </div>

      <!-- VIDEOS GRID -->
      <div class="videos-grid">
        <div class="video-card" *ngFor="let video of paginatedVideos()" (click)="openVideo(video)">
          
          <!-- THUMBNAIL & TYPE BADGE -->
          <div class="thumbnail">
            <img 
              *ngIf="video.url"
              [src]="getThumbnail(video.url)" 
              #img
              (error)="img.style.display = 'none'"
              class="thumb-img">

            <span class="badge" [ngClass]="video.type" style="z-index: 2;">
              {{ video.type.toUpperCase() }}
            </span>
          </div>

          <!-- VIDEO INFO -->
          <div class="video-info">
            <h3>{{ video.title }}</h3>
            
            <!-- CATEGORY TAGS & RATING -->
            <div class="card-tags-row">
              <div class="category-tags">
                <span *ngFor="let catName of video.categoryNames" class="cat-tag">{{ catName }}</span>
              </div>
              
              <span class="rating-inline" *ngIf="video.rating !== undefined && video.rating !== -1">
                ⭐ {{ video.rating | number:'1.1-1' }}
              </span>
            </div>

            <!-- DURATION & LANGUAGE -->
            <p class="meta">
              <span>{{ video.durationMin }} min</span> • 
              <span>{{ video.language }}</span>
            </p>

            <!-- DIFFICULTY -->
            <p class="difficulty-text">Difficulty: {{ video.difficulty }}/3</p>
          </div>
        </div>
      </div>

      <!-- EMPTY RESULTS MESSAGE -->
      <div *ngIf="getFilteredResults().length === 0" class="empty-results">
        <p>No content found matching your filters.</p>
      </div>

      <!-- PAGINATION CONTROLS -->
      <div class="pagination" *ngIf="totalPages() > 1">
        <button (click)="prevPage()" [disabled]="currentPage === 1">‹</button>

        <button
          *ngFor="let p of pagesToDisplay()"
          [class.active]="p === currentPage"
          [disabled]="p === '...'"
          (click)="onPageClick(p)">
          {{ p }}
        </button>

        <button (click)="nextPage()" [disabled]="currentPage === totalPages()">›</button>
      </div>

    </div>
  </div>
</ng-template>