<div class="videos-background">
  <div class="video-detail-page">
    <button class="back" (click)="back()">← Back to library</button>

    <div class="header-container">
      <h2>{{ video.title }}</h2>
      <div class="global-badge" *ngIf="globalRating > 0">
        ⭐ {{ globalRating | number:'1.1-1' }} <small>/ 5</small>
      </div>
    </div>

    <div class="media-container">
      <iframe *ngIf="video.type === 'video'" [src]="getEmbedUrl(video.url) | safeUrl" frameborder="0" allowfullscreen class="youtube-frame"></iframe>
      <audio *ngIf="video.type === 'audio'" controls class="audio-player">
        <source [src]="video.url" type="audio/mpeg">
      </audio>
    </div>

    <div class="video-meta">
      <div class="category-tags">
        <span *ngFor="let cat of categoryNames" class="cat-tag">{{ cat }}</span>
      </div>
      <p>{{ video.durationMin }} min • {{ video.language }} • Difficulty {{ video.difficulty }}/3</p>
    </div>

    <div class="rating-section">
      <h3>Your rating ({{ userRating }}/5)</h3>
      <div class="stars">
        <span *ngFor="let s of starsArr" class="star" (click)="setRating($event, s)">
          <i class="star-icon">★</i>
          <i class="star-icon filled" [style.width.%]="(userRating >= s) ? 100 : (userRating >= s - 0.5 ? 50 : 0)">★</i>
        </span>
      </div>
    </div>

    <div class="comments-section">
      <h3>Comments</h3>
      <div class="add-comment-box">
        <textarea placeholder="Tell us what you thought of this session..." [(ngModel)]="newComment"></textarea>
        <button class="submit-comment-btn" (click)="addComment()" [disabled]="!newComment.trim()">Submit Comment</button>
      </div>

      <div class="comment-card" *ngFor="let c of allComments">
        <div class="comment-header">
          <span class="user-id">{{ c.userName }}</span>
          <span class="user-note" *ngIf="c.userRating">⭐ {{ c.userRating }}</span>
          <small class="date">{{ c.postedAt | date:'dd MMM yyyy' }}</small>
        </div>
        <p class="comment-text">{{ c.text }}</p>
      </div>
      
      <p *ngIf="allComments.length === 0" class="no-comments">No reviews yet. Be the first to rate!</p>
    </div>
  </div>
</div>